webpackJsonp([5],{"2NXm":function(a,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("vR+E"),o=s("3nZU"),i={components:{bg:function(){return s.e(8).then(s.bind(null,"FwV9"))},modal:function(){return s.e(9).then(s.bind(null,"Ol9X"))},energy:function(){return s.e(13).then(s.bind(null,"3Bmr"))},waterTip:function(){return s.e(11).then(s.bind(null,"MY4a"))},photo:function(){return s.e(10).then(s.bind(null,"oKJk"))},plant:function(){return s.e(12).then(s.bind(null,"P1NO"))},award:function(){return s.e(15).then(s.bind(null,"fewE"))}},data:function(){return{showModal:!1,showPhoto:!1,showAward:!1,preImg:"//p8jtbvrrf.bkt.clouddn.com",day:"day",pageState:"loading",photo:{time:"",title:"仙人掌"},action:"fade",action_water:"none",needWater:!1,finished:!1,pageData:null,energy:null,currentName:"",barData:[],water_desc:null}},methods:{getDay:function(){var t=(new Date).getHours();this.day=t>5&&t<18?"day":"night"},cameraFn:function(){this.showPhoto=!0;var t=Object(n.b)().formate();this.photo.time=t,this.photo.title=Object(n.b)().week()},userUpdate:function(){var t=this;this.$ajax({url:Object(o.a)({userId:"huangpu",nickname:"huangpu",avatar:"//p8jtbvrrf.bkt.clouddn.com/icon_pic.png"}).update,success:function(a){0===a.code?(t.pageState="success",t.plant_detail()):(t.pageState="error",t.$toast.show(a.message))}})},plant_detail:function(){var t=this;this.$ajax({url:Object(o.a)({uid:"huangpu"}).detail,type:"get",success:function(a){0===a.code?a.data?(t.pageData=a.data,window.localStorage.setItem("uid",a.data.uid),window.localStorage.setItem("userPlantId",a.data.userPlantId),t.idChangePlant(a.data.plantId),0===a.data.needWater?t.needWater=!1:t.needWater=!0,0===a.data.finished?t.finished=!1:t.finished=!0):t.$router.push("/adopt"):t.$toast.show(a.userMessage||"请求出错啦")}})},waterTipFn:function(){self.$toast.show({message:"主人我需要喝水啦",position:"middle"})},waterFn:function(){var a=this,e={uid:a.pageData.uid,userPlantId:a.pageData.userPlantId};this.$ajax({url:Object(o.a)(e).watering,success:function(e){if(0===e.code){a.$toast.show({position:"middle",type:"success",message:"灌溉成功！"});var s=-e.data.currentTimes/t.data.totalTimes*100;a.water_desc=e.data.totalTimes-e.data.currentTimes,a.barData=[{bg:"#f72f53",value:s,total:e.data.totalEnergy,part:e.data.currentEnergy}],setTimeout(function(){a.showModal=!0,a.plant_detail()},20)}else a.$toast.show(e.userMessage||"还不能浇水哦")}})},waterClose:function(){this.showModal=!1},idChangePlant:function(t){10===t&&(this.currentName="仙人掌"),11===t&&(this.currentName="向日葵")},seedFn:function(){var t=this,a={uid:this.pageData.uid,userPlantId:this.pageData.userPlantId};this.$ajax({url:Object(o.a)(a).harvest_seed,success:function(a){0===a.code?(t.$toast.show({position:"middle",type:"success",message:"收获成功！"}),t.plant_detail()):t.$toast.show(a.userMessage)}})},savePhoto:function(){var t=this;this.showPhoto=!1;var a={uid:window.localStorage.getItem("uid")};this.$ajax({url:Object(o.a)(a).album_picture,success:function(a){0===a.code?t.$toast.show({message:"已保存",type:"success",position:"middle"}):t.$toast.show(a.userMessage||"请稍后保存")}})},showDialog:function(){var t=this,a={uid:window.localStorage.getItem("uid")};this.$ajax({url:Object(o.a)(a).showDialog,type:"get",success:function(a){0===a.code&&(a.data>0?setTimeout(function(){t.showAward=!0},600):t.showAward=!1)}})}},created:function(){var t=this,a=this;this.getDay(),this.userUpdate(),this.showDialog(),setTimeout(function(){t.action_water="enter"},800),window.reload=function(){a.plant_detail()}}},r={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{},[e("page",{attrs:{bgWrap:"#ddd",title:"养花",state:t.pageState}},[e("div",[t.pageData?e("bg",{attrs:{day:t.day}},[e("plant",{attrs:{water:t.needWater,seed:t.finished,plantId:t.pageData.plantId,growStage:t.pageData.growStage},on:{seed:t.seedFn,water:t.waterTipFn}},[e("img",{attrs:{slot:"flower",src:t.preImg+"/"+t.pageData.plantImage,alt:""},slot:"flower"})])],1):t._e(),t._v(" "),t.pageData?e("div",{staticClass:"sun_wrap"},t._l(t.pageData.energyList,function(t,a){return e("energy",{key:a,attrs:{state:0!=t.isAcquire,point:t.size,energyId:t.id,userPlantId:t.userPlantId,index:a}})})):t._e(),t._v(" "),t.pageData?e("div",{staticClass:"count_pane",on:{click:function(a){t.$router.push("/sort")}}},[e("p",[t._v(t._s(t.pageData.totalEnergy))]),t._v(" "),e("button",{staticClass:"sort_btn"},[t._v("排行")])]):t._e(),t._v(" "),e("img",{staticClass:"camera",attrs:{src:"//p8jtbvrrf.bkt.clouddn.com/icon_camera.png",alt:""},on:{click:t.cameraFn}}),t._v(" "),e("img",{staticClass:"photo",attrs:{src:"//p8jtbvrrf.bkt.clouddn.com/icon_pic.png",alt:""},on:{click:function(a){t.$router.push("/photo")}}}),t._v(" "),e("transition",{attrs:{name:"rightOffset"}},["enter"==t.action_water?e("div",{staticClass:"water_grass",on:{click:t.waterFn}},[e("div",{staticClass:"water_glass"},[e("img",{attrs:{src:"//p8jtbvrrf.bkt.clouddn.com/pic_water.png",alt:""}})])]):t._e()])],1)]),t._v(" "),e("modal",{attrs:{showModal:t.showModal}},[e("div",{staticClass:"modal_wrap"},[e("water-tip",{attrs:{title:t.currentName,desc:t.water_desc,barData:t.barData},on:{iclose:t.waterClose}})],1)]),t._v(" "),e("modal",{attrs:{showModal:t.showPhoto,name:"toastSlideUp",background:"rgba(255, 255, 255, 0.3)"}},[e("div",{staticClass:"modal_wrap",staticStyle:{width:"55%",height:"46%"}},[t.pageData?e("photo",{attrs:{day:t.day,showClose:!0,time:t.photo.time,title:t.photo.title},on:{save:t.savePhoto,close:function(a){t.showPhoto=!1}}},[e("img",{attrs:{src:t.preImg+"/"+t.pageData.plantImage,alt:""}})]):t._e()],1)]),t._v(" "),e("modal",{attrs:{showModal:t.showAward,background:"rgba(255, 255, 255, 0.3)"}},[e("div",{staticClass:"modal_wrap award_modal",staticStyle:{width:"80%"}},[e("award",{attrs:{sort:1},on:{callback:function(a){t.showAward=!1},confirm:function(a){t.showAward=!1}}})],1)])],1)},staticRenderFns:[]};var d=s("Z0/y")(i,r,!1,function(t){s("i0et")},null,null);e.default=d.exports},i0et:function(t,a){}});